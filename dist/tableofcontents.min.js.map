{"version":3,"file":"tableofcontents.min.js","sources":["../src/tableofcontents.js"],"sourcesContent":["class Toc {\n    constructor(contentSelector, tocSelector, headingIds, options = {}) {\n        this.contentArea = document.querySelector(contentSelector);\n        this.toc = document.querySelector(tocSelector);\n        if (!this.contentArea || !this.toc) {\n            console.error(\"Content area or TOC container not found.\");\n            return;\n        }\n        this.headingIds = headingIds;\n        this.options = Object.assign({\n            offsetTop: 120,\n            duration: 500,\n            maxItems: 10,\n            classes: {\n                h1: 'toc-h1',\n                h2: 'toc-h2',\n                h3: 'toc-h3',\n                h4: 'toc-h4',\n                h5: 'toc-h5',\n                h6: 'toc-h6'\n            }\n        }, options);\n        this.counters = {\n            h1: 1,\n            h2: 1,\n            h3: 1,\n            h4: 1,\n            h5: 1,\n            h6: 1\n        };\n        this.idCount = 1;\n    }\n\n    initialize() {\n        if (!this.contentArea || !this.toc) {\n            console.error(\"Initialization failed: contentArea or TOC container not found.\");\n            return;\n        }\n        const headings = this.contentArea.querySelectorAll('h1, h2, h3, h4, h5, h6');\n        const tocList = document.createElement('ul');\n\n        let itemCount = 0;\n        let showAllButton = null;\n\n        headings.forEach(h => {\n            itemCount++;\n            const tagName = h.tagName.toLowerCase();\n            const idList = this.headingIds[tagName];\n            const count = this.counters[tagName];\n\n            if (idList && idList.length >= count) {\n                h.id = idList[count - 1];\n            } else {\n                h.id = `header${this.idCount}`;\n            }\n\n            this.counters[tagName]++;\n            this.idCount++;\n\n            const tocItem = document.createElement('li');\n            tocItem.classList.add(this.options.classes[tagName] || `toc-${tagName}`);\n            if (itemCount > this.options.maxItems) {\n                tocItem.classList.add('hidden');\n            }\n            const tocLink = document.createElement('a');\n            tocLink.href = `#${h.id}`;\n            tocLink.textContent = h.textContent;\n            tocLink.addEventListener('click', (e) => {\n                e.preventDefault();\n                const header = document.querySelector(`#${h.id}`);\n                const headerTop = header.getBoundingClientRect().top + window.pageYOffset;\n                const offsetTop = headerTop - this.options.offsetTop;\n                window.scrollTo({\n                    top: offsetTop,\n                    behavior: 'smooth'\n                });\n            });\n            tocItem.appendChild(tocLink);\n\n            let currentList = tocList;\n            if (tagName !== 'h1') {\n                const parentTag = `h${parseInt(tagName[1]) - 1}`;\n                const parentItems = tocList.querySelectorAll(`.${this.options.classes[parentTag] || `toc-${parentTag}`}`);\n                if (parentItems.length > 0) {\n                    const lastParentItem = parentItems[parentItems.length - 1];\n                    let subList = lastParentItem.querySelector('ul');\n                    if (!subList) {\n                        subList = document.createElement('ul');\n                        lastParentItem.appendChild(subList);\n                    }\n                    currentList = subList;\n                }\n            }\n            currentList.appendChild(tocItem);\n        });\n\n        // Create \"Show All\" button if item count exceeds maxItems\n        if (itemCount > this.options.maxItems) {\n            showAllButton = document.createElement('button');\n            showAllButton.textContent = '全て表示';\n            showAllButton.classList.add('show-all');\n            showAllButton.addEventListener('click', () => {\n                const hiddenItems = tocList.querySelectorAll('.hidden');\n                hiddenItems.forEach(item => item.classList.remove('hidden'));\n                showAllButton.style.display = 'none';\n            });\n            this.toc.appendChild(showAllButton);\n        }\n\n        this.toc.appendChild(tocList);\n\n        // Create toggle button\n        const toggleButton = document.createElement('button');\n        toggleButton.textContent = '目次';\n        toggleButton.classList.add('toc-toggle');\n        toggleButton.addEventListener('click', () => {\n            this.toc.classList.toggle('active');\n            if (showAllButton) {\n                showAllButton.style.display = this.toc.classList.contains('active') ? 'block' : 'none';\n            }\n        });\n        this.toc.insertBefore(toggleButton, this.toc.firstChild);\n\n        if (showAllButton) {\n            showAllButton.style.display = 'none';\n        }\n    }\n}\n\n// グローバル関数として提供\nwindow.Toc = Toc;\n"],"names":["window","Toc","constructor","contentSelector","tocSelector","headingIds","options","this","contentArea","document","querySelector","toc","Object","assign","offsetTop","duration","maxItems","classes","h1","h2","h3","h4","h5","h6","counters","idCount","console","error","initialize","headings","querySelectorAll","tocList","createElement","itemCount","showAllButton","forEach","h","tagName","toLowerCase","idList","count","length","id","tocItem","classList","add","tocLink","href","textContent","addEventListener","e","preventDefault","getBoundingClientRect","top","pageYOffset","scrollTo","behavior","appendChild","currentList","parentTag","parseInt","parentItems","lastParentItem","subList","item","remove","style","display","toggleButton","toggle","contains","insertBefore","firstChild"],"mappings":"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"}