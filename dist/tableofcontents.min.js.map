{"version":3,"file":"tableofcontents.min.js","sources":["../src/tableofcontents.js"],"sourcesContent":["class Toc {\n    constructor(contentSelector, tocSelector, headingIds, options = {}) {\n        this.contentArea = document.querySelector(contentSelector);\n        this.toc = document.querySelector(tocSelector);\n        if (!this.contentArea || !this.toc) {\n            console.error(\"Content area or TOC container not found.\");\n            return;\n        }\n        this.headingIds = headingIds;\n        this.options = Object.assign({\n            offsetTop: 120,\n            duration: 500,\n            maxItems: 10,\n            classes: {\n                h1: 'toc-h1',\n                h2: 'toc-h2',\n                h3: 'toc-h3',\n                h4: 'toc-h4',\n                h5: 'toc-h5',\n                h6: 'toc-h6'\n            },\n            showAll: { enabled: false, id: '' },\n            toggleButton: { enabled: false, id: '' },\n            includeHeadings: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6']\n        }, options);\n        this.counters = {\n            h1: 1,\n            h2: 1,\n            h3: 1,\n            h4: 1,\n            h5: 1,\n            h6: 1\n        };\n        this.idCount = 1;\n    }\n\n    sanitizeId(id) {\n        return id.replace(/[^a-zA-Z0-9-_]/g, '');\n    }\n\n    initialize() {\n        if (!this.contentArea || !this.toc) {\n            console.error(\"Initialization failed: contentArea or TOC container not found.\");\n            return;\n        }\n\n        const selector = this.options.includeHeadings.join(', ');\n        const headings = this.contentArea.querySelectorAll(selector);\n        const tocList = document.createElement('ul');\n        let itemCount = 0;\n\n        headings.forEach(h => {\n            const tagName = h.tagName.toLowerCase();\n            const idList = this.headingIds[tagName];\n            const count = this.counters[tagName];\n\n            if (idList && idList.length >= count) {\n                h.id = this.sanitizeId(idList[count - 1]);\n            } else {\n                h.id = `header${this.idCount}`;\n            }\n\n            this.counters[tagName]++;\n            this.idCount++;\n\n            const tocItem = document.createElement('li');\n            tocItem.classList.add(this.options.classes[tagName] || `toc-${tagName}`);\n            if (itemCount < this.options.maxItems || !this.options.includeHeadings.includes(tagName)) {\n                tocItem.style.display = 'list-item';\n            } else {\n                tocItem.style.display = 'none';\n            }\n            itemCount++;\n\n            const tocLink = document.createElement('p');\n            tocLink.setAttribute('data-target', `#${h.id}`);\n            tocLink.textContent = h.textContent;\n            tocLink.style.cursor = 'pointer';\n            tocLink.addEventListener('click', (e) => {\n                e.preventDefault();\n                const targetId = tocLink.getAttribute('data-target').slice(1);\n                const header = document.getElementById(targetId);\n                if (header) {\n                    this.smoothScroll(header);\n                }\n            });\n            tocItem.appendChild(tocLink);\n\n            let currentList = tocList;\n            if (tagName !== 'h1') {\n                const parentTag = `h${parseInt(tagName[1]) - 1}`;\n                const parentItems = tocList.querySelectorAll(`.${this.options.classes[parentTag] || `toc-${parentTag}`}`);\n                if (parentItems.length > 0) {\n                    const lastParentItem = parentItems[parentItems.length - 1];\n                    let subList = lastParentItem.querySelector('ul');\n                    if (!subList) {\n                        subList = document.createElement('ul');\n                        lastParentItem.appendChild(subList);\n                    }\n                    currentList = subList;\n                }\n            }\n            currentList.appendChild(tocItem);\n        });\n\n        this.toc.appendChild(tocList);\n\n        const showAllButton = this.options.showAll.enabled ? document.getElementById(this.options.showAll.id) : null;\n        if (showAllButton && itemCount > this.options.maxItems) {\n            showAllButton.style.display = 'block';\n            showAllButton.addEventListener('click', () => {\n                const hiddenItems = tocList.querySelectorAll('li[style=\"display: none;\"]');\n                hiddenItems.forEach(item => item.style.display = 'list-item');\n                showAllButton.style.display = 'none';\n            });\n        }\n\n        const toggleButton = this.options.toggleButton.enabled ? document.getElementById(this.options.toggleButton.id) : null;\n        if (toggleButton) {\n            toggleButton.addEventListener('click', () => {\n                const isActive = this.toc.style.display !== 'none';\n                if (isActive) {\n                    // 目次を非表示にする\n                    this.toc.style.display = 'none';\n                    if (showAllButton) {\n                        showAllButton.style.display = 'none';\n                    }\n                    // 全ての項目を非表示にリセット\n                    const allItems = tocList.querySelectorAll('li');\n                    allItems.forEach((item, index) => {\n                        if (index >= this.options.maxItems) {\n                            item.style.display = 'none';\n                        }\n                    });\n                } else {\n                    // 目次を表示する\n                    this.toc.style.display = 'block';\n                    const allItems = tocList.querySelectorAll('li');\n                    allItems.forEach((item, index) => {\n                        if (index < this.options.maxItems) {\n                            item.style.display = 'list-item';\n                        } else {\n                            item.style.display = 'none';\n                        }\n                    });\n                    if (showAllButton && itemCount > this.options.maxItems) {\n                        showAllButton.style.display = 'block';\n                    }\n                }\n            });\n        }\n\n        this.toc.style.display = 'block';\n        if (showAllButton && itemCount > this.options.maxItems) {\n            showAllButton.style.display = 'block';\n        }\n    }\n    smoothScroll(targetElement) {\n        const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - this.options.offsetTop;\n        const startPosition = window.pageYOffset;\n        const distance = targetPosition - startPosition;\n        const duration = this.options.duration;\n        let startTime = null;\n\n        const animation = (currentTime) => {\n            if (startTime === null) startTime = currentTime;\n            const timeElapsed = currentTime - startTime;\n            const run = this.ease(timeElapsed, startPosition, distance, duration);\n            window.scrollTo(0, run);\n            if (timeElapsed < duration) requestAnimationFrame(animation);\n        };\n\n        requestAnimationFrame(animation);\n    }\n\n    ease(t, b, c, d) {\n        t /= d / 2;\n        if (t < 1) return c / 2 * t * t + b;\n        t--;\n        return -c / 2 * (t * (t - 2) - 1) + b;\n    }\n}\n\n// グローバル関数として提供\nwindow.Toc = Toc;"],"names":["window","Toc","constructor","contentSelector","tocSelector","headingIds","options","this","contentArea","document","querySelector","toc","Object","assign","offsetTop","duration","maxItems","classes","h1","h2","h3","h4","h5","h6","showAll","enabled","id","toggleButton","includeHeadings","counters","idCount","console","error","sanitizeId","replace","initialize","selector","join","headings","querySelectorAll","tocList","createElement","itemCount","forEach","h","tagName","toLowerCase","idList","count","length","tocItem","classList","add","includes","style","display","tocLink","setAttribute","textContent","cursor","addEventListener","e","preventDefault","targetId","getAttribute","slice","header","getElementById","smoothScroll","appendChild","currentList","parentTag","parseInt","parentItems","lastParentItem","subList","showAllButton","item","index","targetElement","targetPosition","getBoundingClientRect","top","pageYOffset","startPosition","distance","startTime","animation","currentTime","timeElapsed","run","ease","scrollTo","requestAnimationFrame","t","b","c","d"],"mappings":"yBAwLAA,OAAOC,IAxLP,MACIC,WAAAA,CAAYC,EAAiBC,EAAaC,EAAYC,EAAU,CAAA,GAC5DC,KAAKC,YAAcC,SAASC,cAAcP,GAC1CI,KAAKI,IAAMF,SAASC,cAAcN,GAC7BG,KAAKC,aAAgBD,KAAKI,KAI/BJ,KAAKF,WAAaA,EAClBE,KAAKD,QAAUM,OAAOC,OAAO,CACzBC,UAAW,IACXC,SAAU,IACVC,SAAU,GACVC,QAAS,CACLC,GAAI,SACJC,GAAI,SACJC,GAAI,SACJC,GAAI,SACJC,GAAI,SACJC,GAAI,UAERC,QAAS,CAAEC,SAAS,EAAOC,GAAI,IAC/BC,aAAc,CAAEF,SAAS,EAAOC,GAAI,IACpCE,gBAAiB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDtB,GACHC,KAAKsB,SAAW,CACZX,GAAI,EACJC,GAAI,EACJC,GAAI,EACJC,GAAI,EACJC,GAAI,EACJC,GAAI,GAERhB,KAAKuB,QAAU,GA5BXC,QAAQC,MAAM,2CA6BtB,CAEAC,UAAAA,CAAWP,GACP,OAAOA,EAAGQ,QAAQ,kBAAmB,GACzC,CAEAC,UAAAA,GACI,IAAK5B,KAAKC,cAAgBD,KAAKI,IAE3B,YADAoB,QAAQC,MAAM,kEAIlB,MAAMI,EAAW7B,KAAKD,QAAQsB,gBAAgBS,KAAK,MAC7CC,EAAW/B,KAAKC,YAAY+B,iBAAiBH,GAC7CI,EAAU/B,SAASgC,cAAc,MACvC,IAAIC,EAAY,EAEhBJ,EAASK,SAAQC,IACb,MAAMC,EAAUD,EAAEC,QAAQC,cACpBC,EAASxC,KAAKF,WAAWwC,GACzBG,EAAQzC,KAAKsB,SAASgB,GAExBE,GAAUA,EAAOE,QAAUD,EAC3BJ,EAAElB,GAAKnB,KAAK0B,WAAWc,EAAOC,EAAQ,IAEtCJ,EAAElB,GAAK,SAASnB,KAAKuB,UAGzBvB,KAAKsB,SAASgB,KACdtC,KAAKuB,UAEL,MAAMoB,EAAUzC,SAASgC,cAAc,MACvCS,EAAQC,UAAUC,IAAI7C,KAAKD,QAAQW,QAAQ4B,IAAY,OAAOA,KAC1DH,EAAYnC,KAAKD,QAAQU,WAAaT,KAAKD,QAAQsB,gBAAgByB,SAASR,GAC5EK,EAAQI,MAAMC,QAAU,YAExBL,EAAQI,MAAMC,QAAU,OAE5Bb,IAEA,MAAMc,EAAU/C,SAASgC,cAAc,KACvCe,EAAQC,aAAa,cAAe,IAAIb,EAAElB,MAC1C8B,EAAQE,YAAcd,EAAEc,YACxBF,EAAQF,MAAMK,OAAS,UACvBH,EAAQI,iBAAiB,SAAUC,IAC/BA,EAAEC,iBACF,MAAMC,EAAWP,EAAQQ,aAAa,eAAeC,MAAM,GACrDC,EAASzD,SAAS0D,eAAeJ,GACnCG,GACA3D,KAAK6D,aAAaF,EACtB,IAEJhB,EAAQmB,YAAYb,GAEpB,IAAIc,EAAc9B,EAClB,GAAgB,OAAZK,EAAkB,CAClB,MAAM0B,EAAY,KAAIC,SAAS3B,EAAQ,IAAM,GACvC4B,EAAcjC,EAAQD,iBAAiB,IAAIhC,KAAKD,QAAQW,QAAQsD,IAAc,OAAOA,OAC3F,GAAIE,EAAYxB,OAAS,EAAG,CACxB,MAAMyB,EAAiBD,EAAYA,EAAYxB,OAAS,GACxD,IAAI0B,EAAUD,EAAehE,cAAc,MACtCiE,IACDA,EAAUlE,SAASgC,cAAc,MACjCiC,EAAeL,YAAYM,IAE/BL,EAAcK,CAClB,CACJ,CACAL,EAAYD,YAAYnB,EAAQ,IAGpC3C,KAAKI,IAAI0D,YAAY7B,GAErB,MAAMoC,EAAgBrE,KAAKD,QAAQkB,QAAQC,QAAUhB,SAAS0D,eAAe5D,KAAKD,QAAQkB,QAAQE,IAAM,KACpGkD,GAAiBlC,EAAYnC,KAAKD,QAAQU,WAC1C4D,EAActB,MAAMC,QAAU,QAC9BqB,EAAchB,iBAAiB,SAAS,KAChBpB,EAAQD,iBAAiB,8BACjCI,SAAQkC,GAAQA,EAAKvB,MAAMC,QAAU,cACjDqB,EAActB,MAAMC,QAAU,MAAM,KAI5C,MAAM5B,EAAepB,KAAKD,QAAQqB,aAAaF,QAAUhB,SAAS0D,eAAe5D,KAAKD,QAAQqB,aAAaD,IAAM,KAC7GC,GACAA,EAAaiC,iBAAiB,SAAS,KAEnC,GAD4C,SAA3BrD,KAAKI,IAAI2C,MAAMC,QAClB,CAEVhD,KAAKI,IAAI2C,MAAMC,QAAU,OACrBqB,IACAA,EAActB,MAAMC,QAAU,QAGjBf,EAAQD,iBAAiB,MACjCI,SAAQ,CAACkC,EAAMC,KAChBA,GAASvE,KAAKD,QAAQU,WACtB6D,EAAKvB,MAAMC,QAAU,OACzB,GAER,KAAO,CAEHhD,KAAKI,IAAI2C,MAAMC,QAAU,QACRf,EAAQD,iBAAiB,MACjCI,SAAQ,CAACkC,EAAMC,KAChBA,EAAQvE,KAAKD,QAAQU,SACrB6D,EAAKvB,MAAMC,QAAU,YAErBsB,EAAKvB,MAAMC,QAAU,MACzB,IAEAqB,GAAiBlC,EAAYnC,KAAKD,QAAQU,WAC1C4D,EAActB,MAAMC,QAAU,QAEtC,KAIRhD,KAAKI,IAAI2C,MAAMC,QAAU,QACrBqB,GAAiBlC,EAAYnC,KAAKD,QAAQU,WAC1C4D,EAActB,MAAMC,QAAU,QAEtC,CACAa,YAAAA,CAAaW,GACT,MAAMC,EAAiBD,EAAcE,wBAAwBC,IAAMlF,OAAOmF,YAAc5E,KAAKD,QAAQQ,UAC/FsE,EAAgBpF,OAAOmF,YACvBE,EAAWL,EAAiBI,EAC5BrE,EAAWR,KAAKD,QAAQS,SAC9B,IAAIuE,EAAY,KAEhB,MAAMC,EAAaC,IACG,OAAdF,IAAoBA,EAAYE,GACpC,MAAMC,EAAcD,EAAcF,EAC5BI,EAAMnF,KAAKoF,KAAKF,EAAaL,EAAeC,EAAUtE,GAC5Df,OAAO4F,SAAS,EAAGF,GACfD,EAAc1E,GAAU8E,sBAAsBN,EAAU,EAGhEM,sBAAsBN,EAC1B,CAEAI,IAAAA,CAAKG,EAAGC,EAAGC,EAAGC,GAEV,OADAH,GAAKG,EAAI,GACD,EAAUD,EAAI,EAAIF,EAAIA,EAAIC,GAE1BC,EAAI,KADZF,GACsBA,EAAI,GAAK,GAAKC,CACxC"}